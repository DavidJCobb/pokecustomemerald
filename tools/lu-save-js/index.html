<!doctype html>
<html>
   <head>
      <title>Bitpacked save dumper</title>
      <link rel="stylesheet" href="index.css" />
      <script>
console.assert = function(condition, ...args) {
   if (condition)
      return;
   console.log(...args);
   throw new Error("Assertion failed. ", ...args); // actually halt execution
};

// present-day browsers don't format AggregateError in a usable manner, so 
// let's do it for them.
{
   function handler(event) {
      let error;
      if (event.type == "error")
         error = event.error;
      else
         error = event.reason;
      if (!(error instanceof AggregateError))
         return;
      if (error.errors.length > 0) {
         console.error(error);
         console.groupCollapsed("Constituent errors");
         for(let sub of error.errors) {
            console.error(sub);
         }
         console.groupEnd();
         //
         // NOTE: For unhandled promise rejections, `preventDefault` is broken 
         //       in Firefox and will not prevent built-in logging of the 
         //       error object.
         //
         // https://bugzilla.mozilla.org/show_bug.cgi?id=1642147
         //
         event.preventDefault();
         if (navigator.userAgent.toLowerCase().includes('firefox')) {
            console.log("NOTE: The AggregateError itself will be displayed here twice, just below this message, if Mozilla hasn't fixed some of their screwups yet.");
         }
      }
   }
   window.addEventListener("error", handler);
   window.addEventListener("unhandledrejection", handler); // errors in promises
}
      </script>
      <script src="common.js"></script>
      
      <script src="poke-string/charmap.js" charset="utf-8"></script>
      <script src="poke-string/poke-string.js"></script>
      <script src="poke-string/poke-string-printer.js"></script>
      <script src="poke-string/poke-string-dom-printer.js"></script>
      
      <script src="c-definition.js"></script>
      <script src="c-instance.js"></script>
      <script src="c-decl-definition.js"></script>
      <script src="c-type-definition.js"></script>
      <script src="c-decl-instance.js"></script>
      <script src="c-array-instance.js"></script>
      <script src="c-value-instance.js"></script>
      <script src="c-container-type-definition.js"></script>
      <script src="c-integral-type-definition.js"></script>
      <script src="c-struct-definition.js"></script>
      <script src="c-union-definition.js"></script>
      <script src="c-type-instance.js"></script>
      <script src="c-struct-instance.js"></script>
      <script src="c-union-instance.js"></script>
      
      <script src="bytestream.js"></script>
      <script src="extra-data-file.js"></script>
      <script src="extra-data-index.js"></script>
      
      <script src="c-instance-display-overrides.js"></script>
      
      <script src="c-value-path.js"></script>
      <script src="c-bitpack-options.js"></script>
      <script src="instructions.js"></script>
      <script src="save-slot.js"></script>
      <script src="save-file.js"></script>
      <script src="save-format.js"></script>
      
      <script src="bitstream.js"></script>
      <script src="instructions-applier.js"></script>
      
      <script src="emerald.js"></script>
      <script src="emerald-display-overrides.js"></script>
      
      <script src="parse-bbcode.js"></script>
      <script src="custom-elements/bitset-input-element.js"></script>
      <script src="custom-elements/enum-input-element.js"></script>
      <script src="custom-elements/tree-row-view-element.js"></script>
      <script src="custom-elements/tab-view-element.js"></script>
      <script src="custom-elements/c-view-element.js"></script>
      <script src="checksum-recalc-helper.js"></script>
      <script src="custom-elements/c-value-editor-element.js"></script>
      <script src="custom-elements/save-slot-element.js"></script>
      <script src="custom-elements/save-file-element.js"></script>
      
      <script src="data-format-translator.js"></script>
      <script src="c-bufferifier.js"></script>
      
      <script src="editor-enums.js"></script>
   </head>
   <body>
      <h1>Bitpacked save dumper</h1>
      <p>
         Given an XML file which describes a bitpacked save format, and an emulator SAV file made with that format, this page is intended to dump the contents of that save file.
      </p>
      
      <menu>
         <li data-action="import">
            Import save file
         </li>
         <li data-action="translate" data-acts-on-save-file="true">
            Translate current save file
         </li>
         <li data-action="export" data-acts-on-save-file="true">
            Export save file
         </li>
      </menu>
      <tab-view id="save-files"></tab-view>
      
      <dialog id="dialog-import">
         <div class="body">
            <label for="file-xml">Save file format (XML):</label>
            <input type="file" class="xml" />
            
            <label for="file-sav">Save file (SAV):</label>
            <input type="file" class="sav" />
         </div>
         <div class="buttons">
            <button data-action="activate">Load</button>
            <button data-action="cancel">Cancel</button>
         </div>
      </dialog>
      <dialog id="dialog-translate">
         <div class="body">
            <label for="file-xml">Save file format (XML):</label>
         <input type="file" class="xml" />
         </div>
         <div class="buttons">
            <button data-action="activate">Translate</button>
            <button data-action="cancel">Cancel</button>
         </div>
      </dialog>
      <dialog id="dialog-export">
         <div class="body">
            <a download>Click here to save the file.</a>
         </div>
         <div class="buttons">
            <button data-action="cancel">Cancel</button>
         </div>
      </dialog>
      
      <section class="slots">
      </section>
      <script src="index.js"></script>
   </body>
</html>