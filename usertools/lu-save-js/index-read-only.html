<!doctype html>
<html>
   <head>
      <title>Upgrade Your Save</title>
      
      <!--
         This is a version of the save editor that doesn't allow users to 
         freely edit their save files, but does allow them to translate 
         those save files between known formats.
      -->
      
      <link rel="stylesheet" href="index-read-only.css" />
      
      <script src="common.js"></script>
      <script src="assess-sav-version.js"></script>
      
      <!-- app-specific -->
      <script type="module" src="upgrader/save-slot-summary.js"></script>
      <script type="module" src="index-read-only.js"></script>
   </head>
   <body>
      <header>
         <h1>
            <span class="series">Pokémon</span>
            <span class="title">Bitpacked Emerald</span>
         </h1>
         <h2>
            Save file upgrade
         </h2>
         <p class="tagline">Take a save file made on an older version of the hack, and upgrade it to work with a newer version of the hack.</p>
      </header>
      
      <section id="loading" hidden>
         <noscript>
            <style>
               .script { display: none !important; }
               #loading {
                  display: block !important;
               }
            </style>
            This tool requires JavaScript.
         </noscript>
         <div class="script">
            <svg viewBox="0 0 120 120" width="32" height="32">
               <g
                  fill="none"
                  stroke="currentColor"
                  stroke-width="20"
                  stroke-linecap="round"
                  style="transform-box: view-box; transform-origin: center;"
               >
                  <path d="M 60 60 m -50 0 a 50 50 0 0 1 50 -50" />
                  <g stroke="none" fill="currentColor">
                     <circle r="10" cx="18.43" cy="87.78" />
                     <circle r="8"  cx="40.87" cy="106.19" />
                     <circle r="7"  cx="68.03" cy="109.35" />
                  </g>
                  <animateTransform
                     attributeName="transform"
                     attributeType="XML"
                     type="rotate"
                     from="0"
                     to="360"
                     dur="2.5s"
                     repeatCount="indefinite"
                  />
               </g>
            </svg>
            <p>
               Loading... Please wait...
            </p>
         </div>
      </section>
      <script>
//
// Prevent the "loading" animation from being visible as an incredibly 
// brief flicker, should we end up loading very quickly. Specifically: 
// have it be initially hidden, and un-hide it after a tenth of a second 
// if we're still loading by then.
//
window.setTimeout(function() {
   let node = document.getElementById("loading");
   if (!document.body.classList.has("loading")) {
      node.removeAttribute("hidden");
   }
}, 100);
      </script>
   
      <section class="step" id="step-upload">
         <header>Upload your save file here.</header>
         <div class="filepicker">
            <input type="file" id="pick-save-file" />
            <button data-action="clear" title="Clear current file"></button>
         </div>
         <div class="buttons">
            <button data-action="confirm" disabled>Load!</button>
         </div>
      </section>
      <section class="step" hidden id="step-verify">
         <header>Is this you?</header>
         <dl id="loaded-save-info">
            <li>
               <dt>Name:</dt>
               <dd data-field="player-name"></dd>
            </li>
            <li>
               <dt>Gender:</dt>
               <dd data-field="player-gender"></dd>
            </li>
            <li>
               <dt>Trainer ID:</dt>
               <dd data-field="trainer-id"></dd>
            </li>
            <li class="block-content">
               <dt>Pokémon:</dt>
               <dd><ul data-field="player-party"></ul></dd>
            </li>
            <li data-field="player-badges">
               <dt>Badges:</dt>
               <dd><ul></ul></dd>
            </li>
         </dl>
         <div class="buttons">
            <button data-action="confirm">Yes!</button>
            <button data-action="deny">No!</button>
         </div>
      </section>
      <section class="step" hidden id="step-translate">
         <header>Let's upgrade!</header>
         <div class="body" data-condition="can-upgrade">
            <p>
               <span class="if-version-named">Your save file was made on version <span></span>.</span>
               Which version would you like to upgrade to?
            </p>
            <select id="target-version"></select>
         </div>
         <div class="body" data-condition="already-upgraded">
            <p>It doesn't look like the save file format has changed since you last saved the game. There's nothing to upgrade to.</p>
            <p>If the game can't load your save file, then this page may be out of date, or there may be some other problem. Contact the hack author.</p>
         </div>
         <div class="buttons" data-condition="can-upgrade">
            <button data-action="confirm">Upgrade!</button>
         </div>
      </section>
      <section class="step final" hidden id="step-download">
         <header>Your save file has been upgraded.</header>
         <a id="download-link">Click here to download it.</a>
      </section>
   </body>
</html>